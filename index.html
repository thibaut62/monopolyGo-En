<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cards Collection Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gold-card {
            background-color: #fef3c7;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-2xl font-bold text-center mb-4">Cards Collection Manager</h1>
        
        <div class="flex gap-4 justify-center mb-2">
            <button id="saveButton" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">Save</button>
            <button id="loadButton" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">Load</button>
        </div>
        <div class="flex flex-col items-center mb-4">
            <div class="flex gap-4 justify-center">
                <button id="exportDataBtn" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                    Transfer to another device
                </button>
                <button id="importDataBtn" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded">
                    Import from another device
                </button>
            </div>
            <div class="text-xs text-gray-500 mt-1">
                These buttons let you transfer all your data to another device or browser
            </div>
        </div>
        
        <!-- Accounts configuration -->
        <div class="bg-white p-4 rounded shadow mb-4">
            <div class="flex justify-between items-center cursor-pointer" onclick="toggleSection('accountsSection')">
                <h2 class="text-xl font-bold">Accounts Configuration</h2>
                <button class="text-gray-500 hover:text-gray-700 focus:outline-none" id="accountsSectionToggle">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>
            </div>
            <div id="accountsSection" class="mt-2">
                <div id="accountsList" class="mb-2">
                    <!-- Accounts will be displayed here -->
                </div>
                <div class="flex gap-2">
                    <input type="text" id="newAccountName" placeholder="New account name" 
                           class="border rounded px-2 py-1 flex-grow">
                    <button id="addAccountBtn" class="bg-blue-500 text-white px-3 py-1 rounded">
                        Add Account
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Account copy/import buttons -->
        <div id="accountButtons" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2 mb-4">
            <!-- Buttons will be generated here -->
        </div>
        
        <!-- Statistics -->
        <div class="mb-4">
            <div class="bg-white p-4 rounded shadow">
                <div class="flex justify-between items-center cursor-pointer" onclick="toggleSection('statisticsSection')">
                    <h2 class="text-xl font-bold">Statistics</h2>
                    <button class="text-gray-500 hover:text-gray-700 focus:outline-none" id="statisticsSectionToggle">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                </div>
                <div id="statisticsSection" class="mt-2">
                    <div id="statistics">
                        <!-- Statistics will be displayed here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Filters -->
        <div class="bg-white p-4 rounded shadow mb-4">
    <h2 class="text-xl font-bold mb-2">Filters</h2>
    
    <!-- Primary filters group -->
    <div class="flex flex-wrap gap-2 mb-3">
        <button id="filterAll" class="filter-btn px-3 py-1 rounded text-white bg-blue-500">
            All cards
        </button>
        <button id="filterExchangeable" class="filter-btn px-3 py-1 rounded text-white bg-gray-500">
            Possible exchanges
        </button>
        <button id="filterMissing" class="filter-btn px-3 py-1 rounded text-white bg-gray-500">
            Missing cards
        </button>
        <button id="filterGold" class="filter-btn px-3 py-1 rounded text-white bg-gray-500">
            GOLD cards
        </button>
    </div>
    
    <!-- Star filters -->
    <div class="mt-2">
        <div class="text-sm font-medium mb-2">Filter by rarity (stars):</div>
        <div class="flex flex-wrap gap-2">
            <button id="filterStarsAll" class="star-filter-btn px-3 py-1 rounded text-white bg-blue-500">
                All
            </button>
            <button id="filterStars1" class="star-filter-btn px-3 py-1 rounded text-white bg-gray-500">
                ⭐
            </button>
            <button id="filterStars2" class="star-filter-btn px-3 py-1 rounded text-white bg-gray-500">
                ⭐⭐
            </button>
            <button id="filterStars3" class="star-filter-btn px-3 py-1 rounded text-white bg-gray-500">
                ⭐⭐⭐
            </button>
            <button id="filterStars4" class="star-filter-btn px-3 py-1 rounded text-white bg-gray-500">
                ⭐⭐⭐⭐
            </button>
            <button id="filterStars5" class="star-filter-btn px-3 py-1 rounded text-white bg-gray-500">
                ⭐⭐⭐⭐⭐
            </button>
        </div>
    </div>
</div>
        
        <!-- Cards information -->
        <div class="mb-2">
            <p id="cardsInfo" class="text-sm text-gray-600"></p>
        </div>
        
        <!-- Cards table -->
        <div class="bg-white rounded shadow overflow-auto mb-4">
            <table class="w-full">
                <thead>
                    <tr class="bg-gray-100 border-b">
                        <th class="py-2 px-3 text-left">Name</th>
                        <!-- Account headers will be generated dynamically -->
                    </tr>
                </thead>
                <tbody id="cardsTable">
                    <!-- Cards will be displayed here -->
                </tbody>
            </table>
        </div>
    
    </div>
    
    <script>
        // Global variables
        let cards = [];
        let accounts = [];
        let currentFilter = 'all'; // Possible values: 'all', 'exchangeable', 'missing'
        
        // Function to initialize storage with default values if needed
        function initializeStorage() {
            if (!localStorage.getItem('cardsManagerAccounts')) {
                // Default configuration: 2 accounts
                const defaultAccounts = ["Account 1", "Account 2"];
                localStorage.setItem('cardsManagerAccounts', JSON.stringify(defaultAccounts));
            }
        }

        // Function to load accounts from local storage
        function loadAccounts() {
            initializeStorage();
            return JSON.parse(localStorage.getItem('cardsManagerAccounts'));
        }

        // Function to save accounts to local storage
        function saveAccounts(accounts) {
            localStorage.setItem('cardsManagerAccounts', JSON.stringify(accounts));
        }

        // Function to add a new account
        function addAccount(name) {
            const accounts = loadAccounts();
            accounts.push(name);
            saveAccounts(accounts);
            return accounts;
        }

        // Function to remove an account
        function removeAccount(index) {
            const accounts = loadAccounts();
            // Check that at least one account remains
            if (accounts.length <= 1) {
                alert("You must keep at least one account.");
                return accounts;
            }
            
            // Remove the account
            accounts.splice(index, 1);
            
            // Remove quantities associated with this account
            cards = cards.map(card => {
                const newQuantities = card.quantities.filter((_, i) => i !== index);
                return { ...card, quantities: newQuantities };
            });
            
            saveAccounts(accounts);
            saveData(); // Also save the modified cards
            return accounts;
        }

        // Function to rename an account
        function renameAccount(index, newName) {
            const accounts = loadAccounts();
            accounts[index] = newName;
            saveAccounts(accounts);
            return accounts;
        }

        // Initialization function
        function init() {
            console.log("Initializing the application...");
            
            // Attempt to migrate old data if any
            migrateOldData();
            
            // Load accounts
            accounts = loadAccounts();
            
            // Load saved data or initialize
            const savedData = localStorage.getItem('cardsManagerData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    cards = data.cards;
                    
                    // Check if the number of accounts has changed
                    if (cards.length > 0 && cards[0].quantities.length !== accounts.length) {
                        // Adjust quantities to the new number of accounts
                        adjustQuantities();
                    }
                    
                    console.log("Data loaded from local storage:", cards.length, "cards");
                } catch (e) {
                    console.error("Error loading data:", e);
                    initializeDefaultData();
                }
            } else {
                console.log("No saved data found, initializing defaults...");
                initializeDefaultData();
            }

            // Display accounts
            renderAccounts();
            
            // Initialize account buttons
            renderAccountButtons();
            
            // Display cards
            renderCards();
            
            // Update statistics
            updateStatistics();
            
            // Add legend for exchanges
            renderLegend();
            
            // Add event listeners
            addEventListeners();
        }

        // Function to migrate old data to the new format
        function migrateOldData() {
            // Check if we already have configured accounts
            if (localStorage.getItem('cardsManagerAccounts')) {
                return; // Already migrated
            }
            
            // Try to migrate from old format if it exists
            if (localStorage.getItem('monopolyAccounts')) {
                try {
                    const oldAccounts = JSON.parse(localStorage.getItem('monopolyAccounts'));
                    localStorage.setItem('cardsManagerAccounts', JSON.stringify(oldAccounts));
                    console.log("Successfully migrated accounts from old format");
                    
                    // Also migrate the card data if it exists
                    if (localStorage.getItem('monopolyData')) {
                        localStorage.setItem('cardsManagerData', localStorage.getItem('monopolyData'));
                        console.log("Successfully migrated card data from old format");
                    }
                } catch (e) {
                    console.error("Error during migration:", e);
                }
            }
        }

        // Function to adjust quantities if the number of accounts changes
        function adjustQuantities() {
            cards = cards.map(card => {
                let newQuantities = [...card.quantities];
                
                // If the number of accounts has increased, add zeros
                while (newQuantities.length < accounts.length) {
                    newQuantities.push(0);
                }
                
                // If the number of accounts has decreased, truncate
                if (newQuantities.length > accounts.length) {
                    newQuantities = newQuantities.slice(0, accounts.length);
                }
                
                return { ...card, quantities: newQuantities };
            });
        }

        // Function to initialize default data
        function initializeDefaultData() {
            // Make sure cardsData is defined
            if (typeof cardsData === 'undefined') {
                // Create sample data if cardsData is not available
                cardsData = Array.from({ length: 36 }, (_, i) => ({
                    id: i + 1,
                    name: `Card ${i + 1}`,
                    stars: (i % 3) + 1,
                    isGold: i % 10 === 0
                }));
            }
            
            cards = cardsData.map(card => {
                // Create a quantity array with a zero per account
                const quantities = new Array(accounts.length).fill(0);
                return { ...card, quantities };
            });
        }

        // Function to render the accounts list
        function renderAccounts() {
            const container = document.getElementById('accountsList');
            container.innerHTML = '';
            
            accounts.forEach((account, index) => {
                const accountDiv = document.createElement('div');
                accountDiv.className = 'flex items-center justify-between p-2 border-b';
                accountDiv.innerHTML = `
                    <span class="flex-grow">${account}</span>
                    <div class="flex gap-2">
                        <button class="rename-account-btn bg-yellow-500 text-white px-2 py-1 rounded text-xs" 
                                data-index="${index}">
                            Rename
                        </button>
                        <button class="remove-account-btn bg-red-500 text-white px-2 py-1 rounded text-xs" 
                                data-index="${index}">
                            Delete
                        </button>
                    </div>
                `;
                container.appendChild(accountDiv);
            });
            
            // Add event listeners for buttons
            document.querySelectorAll('.rename-account-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const newName = prompt('New account name:', accounts[index]);
                    if (newName && newName.trim() !== '') {
                        accounts = renameAccount(index, newName.trim());
                        renderAccounts();
                        renderAccountButtons();
                        renderCards();
                        updateStatistics();
                    }
                });
            });
            
            document.querySelectorAll('.remove-account-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    if (confirm(`Are you sure you want to delete the account "${accounts[index]}"?`)) {
                        accounts = removeAccount(index);
                        renderAccounts();
                        renderAccountButtons();
                        renderCards();
                        updateStatistics();
                    }
                });
            });
        }

        // Function to render account buttons
        function renderAccountButtons() {
            const container = document.getElementById('accountButtons');
            container.innerHTML = '';
            
            accounts.forEach((account, index) => {
                const div = document.createElement('div');
                div.className = 'mb-2';
                div.innerHTML = `
                    <div class="text-sm font-medium mb-1">${account}</div>
                    <div class="flex gap-2">
                        <button class="copy-btn bg-blue-500 text-white px-2 py-1 rounded text-xs" 
                                data-account-index="${index}">Copy quantities</button>
                        <button class="import-btn bg-green-500 text-white px-2 py-1 rounded text-xs" 
                                data-account-index="${index}">Import quantities</button>
                    </div>
                `;
                container.appendChild(div);
            });
            
            // Add event listeners
            document.querySelectorAll('.copy-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const accountIndex = parseInt(this.getAttribute('data-account-index'));
                    copyAccount(accountIndex);
                });
            });
            
            document.querySelectorAll('.import-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const accountIndex = parseInt(this.getAttribute('data-account-index'));
                    importAccount(accountIndex);
                });
            });
        }

        // Remplacez la fonction copyAccount par celle-ci
        function copyAccount(accountIndex) {
            // Start with "Quantity" to indicate the format
            let quantitiesText = "Quantity\n";
            
            // Add each quantity on a new line
            cards.forEach(card => {
                quantitiesText += card.quantities[accountIndex] + "\n";
            });
            
            // Create a temporary textarea element for copying
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = quantitiesText;
            tempTextArea.setAttribute('readonly', '');
            tempTextArea.style.position = 'absolute';
            tempTextArea.style.left = '-9999px';
            document.body.appendChild(tempTextArea);
            
            // Select and copy the text
            tempTextArea.select();
            let success = false;
            
            try {
                // First try with document.execCommand (works on all browsers)
                success = document.execCommand('copy');
                
                // If that fails, try with the Clipboard API
                if (!success) {
                    navigator.clipboard.writeText(quantitiesText)
                        .then(() => {
                            success = true;
                            alert(`${accounts[accountIndex]} data copied to clipboard.`);
                        })
                        .catch(err => {
                            console.error('Error copying data:', err);
                            alert('Error copying data. Try selecting the text manually.');
                        });
                } else {
                    alert(`${accounts[accountIndex]} data copied to clipboard.`);
                }
            } catch (err) {
                console.error('Error copying data:', err);
                alert('Error copying data. Try selecting the text manually.');
            }
            
            // Clean up
            document.body.removeChild(tempTextArea);
        }

        // to better handle pasted data
        function importAccount(accountIndex) {
            // Create a textarea element for pasting
            const pasteArea = document.createElement('textarea');
            pasteArea.style.width = '100%';
            pasteArea.style.height = '100px';
            pasteArea.style.padding = '10px';
            pasteArea.style.border = '1px solid #ccc';
            pasteArea.style.borderRadius = '4px';
            pasteArea.style.fontFamily = 'monospace';
            pasteArea.style.fontSize = '12px';
            pasteArea.placeholder = "Paste your import data here...";
            
            // Create a modal dialog for pasting
            const overlay = document.createElement('div');
            overlay.style.position = 'fixed';
            overlay.style.top = '0';
            overlay.style.left = '0';
            overlay.style.width = '100%';
            overlay.style.height = '100%';
            overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
            overlay.style.zIndex = '1000';
            overlay.style.display = 'flex';
            overlay.style.justifyContent = 'center';
            overlay.style.alignItems = 'center';
            
            const dialog = document.createElement('div');
            dialog.style.backgroundColor = '#fff';
            dialog.style.padding = '20px';
            dialog.style.borderRadius = '8px';
            dialog.style.maxWidth = '600px';
            dialog.style.width = '90%';
            
            dialog.innerHTML = `
                <h2 style="font-size: 20px; font-weight: bold; margin-bottom: 15px;">
                    Import data for ${accounts[accountIndex]}
                </h2>
                <p style="margin-bottom: 15px;">
                    Paste the data to import in the box below.
                </p>
            `;
            
            const buttonContainer = document.createElement('div');
            buttonContainer.style.display = 'flex';
            buttonContainer.style.justifyContent = 'space-between';
            buttonContainer.style.marginTop = '20px';
            
            const importBtn = document.createElement('button');
            importBtn.textContent = 'Import';
            importBtn.style.padding = '8px 16px';
            importBtn.style.backgroundColor = '#10b981';
            importBtn.style.color = 'white';
            importBtn.style.border = 'none';
            importBtn.style.borderRadius = '4px';
            importBtn.style.cursor = 'pointer';
            
            const cancelBtn = document.createElement('button');
            cancelBtn.textContent = 'Cancel';
            cancelBtn.style.padding = '8px 16px';
            cancelBtn.style.backgroundColor = '#6b7280';
            cancelBtn.style.color = 'white';
            cancelBtn.style.border = 'none';
            cancelBtn.style.borderRadius = '4px';
            cancelBtn.style.cursor = 'pointer';
            
            buttonContainer.appendChild(importBtn);
            buttonContainer.appendChild(cancelBtn);
            
            dialog.appendChild(pasteArea);
            dialog.appendChild(buttonContainer);
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus on the textarea to make pasting easier
            pasteArea.focus();
            
            // Add event listeners
            importBtn.addEventListener('click', function() {
                const input = pasteArea.value;
                if (!input || input.trim() === "") {
                    alert("No data provided.");
                    return;
                }
                
                try {
                    // Split the input by line breaks
                    let lines = input.split(/\r?\n/);
                    
                    // Remove the word "Quantity" if present in the first line
                    if (lines.length > 0 && lines[0].trim().toLowerCase() === "quantity") {
                        lines = lines.slice(1);
                    }
                    
                    // Filter empty lines and convert to numbers
                    const quantities = lines
                        .map(line => line.trim())
                        .filter(line => line !== "")
                        .map(line => parseInt(line, 10))
                        .filter(num => !isNaN(num));
                    
                    console.log("Detected quantities:", quantities);
                    
                    if (quantities.length === 0) {
                        alert("No valid quantities found.");
                        return;
                    }
                    
                    let importCount = 0;
                    
                    // Confirm before import
                    if (confirm('This action will replace the current data for this account. Are you sure you want to continue?')) {
                        // Process each quantity and assign to the corresponding card
                        for (let i = 0; i < Math.min(quantities.length, cards.length); i++) {
                            cards[i].quantities[accountIndex] = quantities[i];
                            importCount++;
                        }
                        
                        if (importCount > 0) {
                            alert(`Import successful: ${importCount} cards updated for ${accounts[accountIndex]}.`);
                            renderCards();
                            updateStatistics();
                            saveData(); // Save the changes
                            document.body.removeChild(overlay);
                        } else {
                            alert("No cards could be imported.");
                        }
                    }
                } catch (e) {
                    console.error('Error during import:', e);
                    alert('Error during import: ' + e.message);
                }
            });
            
            cancelBtn.addEventListener('click', function() {
                document.body.removeChild(overlay);
            });
        }

        // Update card display to take into account a variable number of accounts
        function renderCards() {
            console.log("Rendering cards...", cards.length, "cards to display");
            
            const tbody = document.getElementById('cardsTable');
            tbody.innerHTML = '';
            
            // Update the table header to display all accounts
            const thead = document.querySelector('thead tr');
            thead.innerHTML = `
                <th class="py-2 px-3 text-left">Name</th>
                ${accounts.map(account => `<th class="py-2 px-3 text-center">${account}</th>`).join('')}
            `;
            
            // Filter cards based on the active filter
            let filteredCards = [...cards]; // Default: all cards
            
            if (currentFilter === 'exchangeable') {
                // Cards where at least one account has extra (>1) 
                // and at least one other account needs it (=0)
                filteredCards = cards.filter(card => {
                    const hasExtraInSomeAccount = card.quantities.some(qty => qty > 1);
                    const isMissingInSomeAccount = card.quantities.some(qty => qty === 0);
                    return hasExtraInSomeAccount && isMissingInSomeAccount;
                });
            } else if (currentFilter === 'missing') {
                // Cards missing in at least one account
                filteredCards = cards.filter(card => {
                    return card.quantities.some(qty => qty === 0);
                });
            }
            
            // Display the filtered cards
            filteredCards.forEach(card => {
                const tr = document.createElement('tr');
                tr.className = `border-t hover:bg-gray-50 ${card.isGold ? 'gold-card' : ''}`;
                
                // Calculate set number
                const setNumber = Math.floor((card.id - 1) / 9) + 1;
                
                // Name cell with set number, name, and stars
                let html = `
                    <td class="py-2 px-3">
                        <span class="inline-block bg-gray-200 text-gray-800 px-2 py-1 rounded-full text-xs font-bold mr-2">Set ${setNumber}</span>
                        ${card.name} 
                        ${card.isGold ? 
                            '<span class="inline-block bg-yellow-200 text-yellow-800 px-2 py-1 rounded text-xs font-bold mx-1">GOLD</span>' : 
                            ''
                        }
                        <span class="text-yellow-500">${'⭐'.repeat(card.stars)}</span>
                    </td>
                `;
                
                // Add a cell for each account
                accounts.forEach((_, accountIndex) => {
                    // Check for exchange possibilities
                    let accountClass = '';
                    let exchangeIndicator = '';
                    
                    // Detect exchange possibilities
                    const hasExtra = card.quantities[accountIndex] > 1;
                    
                    // Check if other accounts need this card
                    const otherAccountsNeed = accounts.some((_, otherIndex) => 
                        otherIndex !== accountIndex && card.quantities[otherIndex] === 0
                    );
                    
                    if (hasExtra && otherAccountsNeed) {
                        accountClass = 'bg-green-100 border-green-300 border';
                        exchangeIndicator = '<span class="inline-block ml-1 text-green-600 text-xs">⟷</span>';
                    }
                    
                    const needsCard = card.quantities[accountIndex] === 0;
                    const otherAccountsHaveExtra = accounts.some((_, otherIndex) => 
                        otherIndex !== accountIndex && card.quantities[otherIndex] > 1
                    );
                    
                    if (needsCard && otherAccountsHaveExtra) {
                        accountClass = 'bg-blue-100 border-blue-300 border';
                    }
                    
                    html += `
                        <td class="py-2 px-3 text-center ${accountClass}">
                            <input type="number" min="0" class="quantity-input w-12 text-center border rounded" 
                                data-card-id="${card.id}" data-account-index="${accountIndex}" value="${card.quantities[accountIndex]}">
                            ${exchangeIndicator}
                        </td>
                    `;
                });
                
                tr.innerHTML = html;
                tbody.appendChild(tr);
            });
            
            // Update the number of cards displayed
            const totalCards = cards.length;
            const displayedCards = filteredCards.length;
            
            let infoText = `Total cards: ${totalCards} (including ${cards.filter(c => c.isGold).length} GOLD cards)`;
            if (currentFilter !== 'all') {
                infoText += ` | Displayed: ${displayedCards}`;
            }
            
            document.getElementById('cardsInfo').textContent = infoText;
            
            // Add event listeners to inputs
            addQuantityInputListeners();
        }

        // Separate function to add listeners to quantity inputs
        function addQuantityInputListeners() {
            document.querySelectorAll('.quantity-input').forEach(input => {
                input.addEventListener('change', function() {
                    const cardId = parseInt(this.getAttribute('data-card-id'));
                    const accountIndex = parseInt(this.getAttribute('data-account-index'));
                    const newValue = parseInt(this.value) || 0;
                    
                    updateQuantity(cardId, accountIndex, newValue);
                });
            });
        }

        // Function to update a card's quantity
        function updateQuantity(cardId, accountIndex, newValue) {
            cards = cards.map(card => {
                if (card.id === cardId) {
                    const newQuantities = [...card.quantities];
                    newQuantities[accountIndex] = newValue;
                    return { ...card, quantities: newQuantities };
                }
                return card;
            });
            
            // Update statistics
            updateStatistics();
            
            // Refresh the card display to update exchange indicators
            renderCards();
        }

        // Updated function for statistics
        function updateStatistics() {
            const container = document.getElementById('statistics');
            container.innerHTML = '';
            
            // Create a flex container for horizontal display
            const flexContainer = document.createElement('div');
            flexContainer.className = 'flex flex-wrap justify-center gap-4';
            container.appendChild(flexContainer);
            
            // Calculate unique cards owned per account
            const uniqueCardsByAccount = accounts.map((_, index) => {
                return cards.filter(card => card.quantities[index] > 0).length;
            });
            
            // Display statistics for each account
            accounts.forEach((account, index) => {
                const div = document.createElement('div');
                div.className = 'text-center bg-white p-3 rounded shadow';
                
                // Calculate cards with extra copies
                const extraCards = cards.filter(card => card.quantities[index] > 1).length;
                
                // Calculate missing cards
                const missingCards = cards.filter(card => card.quantities[index] === 0).length;
                
                // Calculate exchangeable cards (extra for this account AND missing for at least one other)
                const exchangeableCards = cards.filter(card => {
                    return card.quantities[index] > 1 && // This account has extras
                           accounts.some((_, otherIndex) => otherIndex !== index && card.quantities[otherIndex] === 0); // Another account needs it
                }).length;
                
                div.innerHTML = `
                    <div class="font-medium">${account}</div>
                    <div class="text-xl font-bold">${uniqueCardsByAccount[index]}/${cards.length}</div>
                    <div class="text-sm mt-1">
                        <div class="flex justify-between">
                            <span>Missing:</span>
                            <span class="font-medium text-blue-600">${missingCards}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Duplicates:</span>
                            <span class="font-medium text-green-600">${extraCards}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Exchangeable:</span>
                            <span class="font-medium text-purple-600">${exchangeableCards}</span>
                        </div>
                    </div>
                `;
                flexContainer.appendChild(div);
            });
            
            // Add global statistics
            const exchangeablePairs = cards.filter(card => {
                const hasExtraInSomeAccount = card.quantities.some(qty => qty > 1);
                const isMissingInSomeAccount = card.quantities.some(qty => qty === 0);
                return hasExtraInSomeAccount && isMissingInSomeAccount;
            }).length;
            
            const globalStats = document.createElement('div');
            globalStats.className = 'w-full text-center mt-4';
            globalStats.innerHTML = `
                <div class="inline-block bg-indigo-100 p-2 rounded border border-indigo-200">
                    <span class="font-medium">Possible exchanges:</span>
                    <span class="font-bold text-indigo-600 ml-2">${exchangeablePairs} cards</span>
                </div>
            `;
            container.appendChild(globalStats);
        }

        // Function to add a legend explaining exchange indicators
        function renderLegend() {
            const infoDiv = document.getElementById('cardsInfo');
            
            // Create a container for the legend
            const legendDiv = document.createElement('div');
            legendDiv.className = 'mt-2 text-sm flex flex-wrap gap-4 justify-center';
            
            // Add explanations for indicators
            legendDiv.innerHTML = `
                <div class="flex items-center">
                    <span class="inline-block w-4 h-4 bg-green-100 border border-green-300 mr-1"></span>
                    <span>Can give (duplicates)</span>
                </div>
                <div class="flex items-center">
                    <span class="inline-block w-4 h-4 bg-blue-100 border border-blue-300 mr-1"></span>
                    <span>Need (missing)</span>
                </div>
                <div class="flex items-center">
                    <span class="inline-block mr-1 text-green-600">⟷</span>
                    <span>Exchange possible</span>
                </div>
                <div class="flex items-center">
                    <span class="inline-block bg-yellow-200 text-yellow-800 px-2 py-1 rounded text-xs font-bold mr-1">GOLD</span>
                    <span>GOLD card</span>
                </div>
            `;
            
            // Insert the legend after the card info
            infoDiv.parentNode.insertBefore(legendDiv, infoDiv.nextSibling);
        }

        // Function to set the active filter
        function setActiveFilter(filter) {
            currentFilter = filter;
            
            // Update button appearance
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-blue-500');
                btn.classList.add('bg-gray-500');
            });
            
            const activeButton = document.getElementById(`filter${filter.charAt(0).toUpperCase() + filter.slice(1)}`);
            if (activeButton) {
                activeButton.classList.remove('bg-gray-500');
                activeButton.classList.add('bg-blue-500');
            }
            
            // Update card display
            renderCards();
        }

        // Function to add all event listeners
        function addEventListeners() {
            // Existing buttons
            document.getElementById('saveButton').addEventListener('click', saveData);
            document.getElementById('loadButton').addEventListener('click', loadData);
            
            // New account buttons
            document.getElementById('addAccountBtn').addEventListener('click', function() {
                const input = document.getElementById('newAccountName');
                const name = input.value.trim();
                
                if (name !== '') {
                    accounts = addAccount(name);
                    input.value = '';
                    renderAccounts();
                    renderAccountButtons();
                    adjustQuantities();
                    renderCards();
                    updateStatistics();
                }
            });
            
            // Enter key listener in the text field
            document.getElementById('newAccountName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('addAccountBtn').click();
                }
            });
            
            // Add listeners for filter buttons
            document.getElementById('filterAll').addEventListener('click', function() {
                setActiveFilter('all');
            });
            
            document.getElementById('filterExchangeable').addEventListener('click', function() {
                setActiveFilter('exchangeable');
            });
            
            document.getElementById('filterMissing').addEventListener('click', function() {
                setActiveFilter('missing');
            });
            
            // Export/Import buttons
            document.getElementById('exportDataBtn').addEventListener('click', showExportDialog);
            document.getElementById('importDataBtn').addEventListener('click', showImportDialog);
            
            // Add listeners for quantity inputs
            addQuantityInputListeners();
        }

        // Function to save data
        function saveData() {
            const data = {
                cards: cards,
                lastUpdate: new Date().toISOString()
            };
            
            localStorage.setItem('cardsManagerData', JSON.stringify(data));
            alert('Data successfully saved!');
        }

        // Function to load data
        function loadData() {
            const savedData = localStorage.getItem('cardsManagerData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    cards = data.cards;
                    
                    // Check if the number of accounts has changed since saving
                    if (cards.length > 0 && cards[0].quantities.length !== accounts.length) {
                        adjustQuantities();
                    }
                    
                    renderCards();
                    updateStatistics();
                    alert('Data successfully loaded!');
                } catch (e) {
                    console.error('Error loading data:', e);
                    alert('Error loading data.');
                }
            } else {
                alert('No saved data found.');
            }
        }

        // Function to generate an export code for the data
        function generateExportCode() {
            try {
                // Prepare the data
                const dataToExport = {
                    accounts: accounts,
                    cards: cards,
                    timestamp: new Date().toISOString()
                };
                
                // Convert to JSON and encode to base64
                const jsonData = JSON.stringify(dataToExport);
                const base64Data = btoa(unescape(encodeURIComponent(jsonData)));
                
                return base64Data;
            } catch (error) {
                console.error('Error generating export code:', error);
                return null;
            }
        }

        // Function to import data from a code
       function importFromCode(code) {
        if (!code || code.trim() === '') {
            alert('No code was provided.');
            return false;
        }
        
        try {
            // Decode the base64 data and parse the JSON
            const jsonData = decodeURIComponent(escape(atob(code.trim())));
            const importedData = JSON.parse(jsonData);
            
            if (!importedData.accounts || !importedData.cards) {
                alert('The import code is invalid or corrupted.');
                return false;
            }
            
            // Update local data
            accounts = importedData.accounts;
            cards = importedData.cards;
            
            // Save the data and update the interface
            saveAccounts(accounts);
            saveData();
            renderAccounts();
            renderAccountButtons();
            renderCards();
            updateStatistics();
            
            return true;
        } catch (error) {
            console.error('Error importing data:', error);
            alert('The import code is invalid or corrupted.');
            return false;
        }
    }

    // Function to show the export dialog
    function showExportDialog() {
        const exportCode = generateExportCode();
        
        if (!exportCode) {
            alert('An error occurred while generating the export code.');
            return;
        }
        
        // Create the overlay dialog
        const overlay = document.createElement('div');
        overlay.style.position = 'fixed';
        overlay.style.top = '0';
        overlay.style.left = '0';
        overlay.style.width = '100%';
        overlay.style.height = '100%';
        overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
        overlay.style.zIndex = '1000';
        overlay.style.display = 'flex';
        overlay.style.justifyContent = 'center';
        overlay.style.alignItems = 'center';
        
        // Create the dialog box
        const dialog = document.createElement('div');
        dialog.style.backgroundColor = '#fff';
        dialog.style.padding = '20px';
        dialog.style.borderRadius = '8px';
        dialog.style.maxWidth = '600px';
        dialog.style.width = '90%';
        dialog.style.maxHeight = '80vh';
        dialog.style.overflowY = 'auto';
        
        // Dialog content
        dialog.innerHTML = `
            <h2 style="font-size: 20px; font-weight: bold; margin-bottom: 15px;">Data Export Code</h2>
            <p style="margin-bottom: 15px;">
                Copy this code and save it. You can use it on another device 
                to import your data.
            </p>
            <div style="position: relative; margin-bottom: 20px;">
                <textarea id="exportCodeArea" 
                    style="width: 100%; height: 100px; padding: 10px; border: 1px solid #ccc; 
                           border-radius: 4px; font-family: monospace; font-size: 12px;"
                    readonly>${exportCode}</textarea>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <button id="copyCodeBtn" 
                    style="padding: 8px 16px; background-color: #3b82f6; color: white; 
                           border: none; border-radius: 4px; cursor: pointer;">
                    Copy code
                </button>
                <button id="closeDialogBtn" 
                    style="padding: 8px 16px; background-color: #6b7280; color: white; 
                           border: none; border-radius: 4px; cursor: pointer;">
                    Close
                </button>
            </div>
        `;
        
        // Add the dialog to the overlay, then to the page
        overlay.appendChild(dialog);
        document.body.appendChild(overlay);
        
        // Add event listeners for the buttons
        document.getElementById('copyCodeBtn').addEventListener('click', function() {
            const textarea = document.getElementById('exportCodeArea');
            textarea.select();
            document.execCommand('copy');
            this.textContent = 'Copied!';
            this.style.backgroundColor = '#10b981';
            setTimeout(() => {
                this.textContent = 'Copy code';
                this.style.backgroundColor = '#3b82f6';
            }, 2000);
        });
        
        document.getElementById('closeDialogBtn').addEventListener('click', function() {
            document.body.removeChild(overlay);
        });
        
        // Automatically select the code text
        const textarea = document.getElementById('exportCodeArea');
        textarea.focus();
        textarea.select();
    }

    // Function to show the import dialog
    function showImportDialog() {
        // Create the overlay dialog
        const overlay = document.createElement('div');
        overlay.style.position = 'fixed';
        overlay.style.top = '0';
        overlay.style.left = '0';
        overlay.style.width = '100%';
        overlay.style.height = '100%';
        overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
        overlay.style.zIndex = '1000';
        overlay.style.display = 'flex';
        overlay.style.justifyContent = 'center';
        overlay.style.alignItems = 'center';
        
        // Create the dialog box
        const dialog = document.createElement('div');
        dialog.style.backgroundColor = '#fff';
        dialog.style.padding = '20px';
        dialog.style.borderRadius = '8px';
        dialog.style.maxWidth = '600px';
        dialog.style.width = '90%';
        
        // Dialog content
        dialog.innerHTML = `
            <h2 style="font-size: 20px; font-weight: bold; margin-bottom: 15px;">Import Data</h2>
            <p style="margin-bottom: 15px;">
                Paste the export code that you previously generated on another device.
            </p>
            <div style="margin-bottom: 20px;">
                <textarea id="importCodeArea" 
                    style="width: 100%; height: 100px; padding: 10px; border: 1px solid #ccc; 
                           border-radius: 4px; font-family: monospace; font-size: 12px;"
                    placeholder="Paste your import code here..."></textarea>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <button id="importBtn" 
                    style="padding: 8px 16px; background-color: #10b981; color: white; 
                           border: none; border-radius: 4px; cursor: pointer;">
                    Import
                </button>
                <button id="cancelImportBtn" 
                    style="padding: 8px 16px; background-color: #6b7280; color: white; 
                           border: none; border-radius: 4px; cursor: pointer;">
                    Cancel
                </button>
            </div>
        `;
        
        // Add the dialog to the overlay, then to the page
        overlay.appendChild(dialog);
        document.body.appendChild(overlay);
        
        // Add event listeners for the buttons
        document.getElementById('importBtn').addEventListener('click', function() {
            const code = document.getElementById('importCodeArea').value;
            if (code.trim() === '') {
                alert('Please paste a valid import code.');
                return;
            }
            
            // Confirm before import
            if (confirm('This action will replace all your current data. Are you sure you want to continue?')) {
                const success = importFromCode(code);
                if (success) {
                    alert('Data imported successfully!');
                    document.body.removeChild(overlay);
                }
            }
        });
        
        document.getElementById('cancelImportBtn').addEventListener('click', function() {
            document.body.removeChild(overlay);
        });
        
        // Focus on the text area
        document.getElementById('importCodeArea').focus();
    }

    // Variables for filters
//let currentFilter = 'all'; // Types: 'all', 'exchangeable', 'missing', 'gold'
let currentStarsFilter = 'all'; // Types: 'all', 1, 2, 3, 4, 5

// Function to update the existing renderCards function
// This part should replace your current renderCards function or be integrated into it
function renderCards() {
    console.log("Rendering cards...", cards.length, "cards to display");
    
    const tbody = document.getElementById('cardsTable');
    tbody.innerHTML = '';
    
    // Update the table header to display all accounts
    const thead = document.querySelector('thead tr');
    thead.innerHTML = `
        <th class="py-2 px-3 text-left">Name</th>
        ${accounts.map(account => `<th class="py-2 px-3 text-center">${account}</th>`).join('')}
    `;
    
    // Filter cards based on active filters
    let filteredCards = [...cards]; // Default: all cards
    
    // Apply main filter
    if (currentFilter === 'exchangeable') {
        // Cards where at least one account has extra (>1) 
        // and at least one other account needs it (=0)
        filteredCards = filteredCards.filter(card => {
            const hasExtraInSomeAccount = card.quantities.some(qty => qty > 1);
            const isMissingInSomeAccount = card.quantities.some(qty => qty === 0);
            return hasExtraInSomeAccount && isMissingInSomeAccount;
        });
    } else if (currentFilter === 'missing') {
        // Cards missing in at least one account
        filteredCards = filteredCards.filter(card => {
            return card.quantities.some(qty => qty === 0);
        });
    } else if (currentFilter === 'gold') {
        // Only GOLD cards
        filteredCards = filteredCards.filter(card => card.isGold);
    }
    
    // Apply star filter
    if (currentStarsFilter !== 'all') {
        const starsCount = parseInt(currentStarsFilter);
        filteredCards = filteredCards.filter(card => card.stars === starsCount);
    }
    
    // Display the filtered cards
    filteredCards.forEach(card => {
        const tr = document.createElement('tr');
        tr.className = `border-t hover:bg-gray-50 ${card.isGold ? 'gold-card' : ''}`;
        
        // Calculate set number
        const setNumber = Math.floor((card.id - 1) / 9) + 1;
        
        // Name cell with set number, name, and stars
        let html = `
            <td class="py-2 px-3">
                <span class="inline-block bg-gray-200 text-gray-800 px-2 py-1 rounded-full text-xs font-bold mr-2">Set ${setNumber}</span>
                ${card.name} 
                ${card.isGold ? 
                    '<span class="inline-block bg-yellow-200 text-yellow-800 px-2 py-1 rounded text-xs font-bold mx-1">GOLD</span>' : 
                    ''
                }
                <span class="text-yellow-500">${'⭐'.repeat(card.stars)}</span>
            </td>
        `;
        
        // Add a cell for each account
        accounts.forEach((_, accountIndex) => {
            // Check for exchange possibilities
            let accountClass = '';
            let exchangeIndicator = '';
            
            // Detect exchange possibilities
            const hasExtra = card.quantities[accountIndex] > 1;
            
            // Check if other accounts need this card
            const otherAccountsNeed = accounts.some((_, otherIndex) => 
                otherIndex !== accountIndex && card.quantities[otherIndex] === 0
            );
            
            if (hasExtra && otherAccountsNeed) {
                accountClass = 'bg-green-100 border-green-300 border';
                exchangeIndicator = '<span class="inline-block ml-1 text-green-600 text-xs">⟷</span>';
            }
            
            const needsCard = card.quantities[accountIndex] === 0;
            const otherAccountsHaveExtra = accounts.some((_, otherIndex) => 
                otherIndex !== accountIndex && card.quantities[otherIndex] > 1
            );
            
            if (needsCard && otherAccountsHaveExtra) {
                accountClass = 'bg-blue-100 border-blue-300 border';
            }
            
            html += `
                <td class="py-2 px-3 text-center ${accountClass}">
                    <input type="number" min="0" class="quantity-input w-12 text-center border rounded" 
                        data-card-id="${card.id}" data-account-index="${accountIndex}" value="${card.quantities[accountIndex]}">
                    ${exchangeIndicator}
                </td>
            `;
        });
        
        tr.innerHTML = html;
        tbody.appendChild(tr);
    });
    
    // Update the number of cards displayed
    const totalCards = cards.length;
    const displayedCards = filteredCards.length;
    
    let infoText = `Total cards: ${totalCards} (including ${cards.filter(c => c.isGold).length} GOLD cards)`;
    if (currentFilter !== 'all' || currentStarsFilter !== 'all') {
        infoText += ` | Displayed: ${displayedCards}`;
    }
    
    document.getElementById('cardsInfo').textContent = infoText;
    
    // Add event listeners to inputs
    addQuantityInputListeners();
}

// Function to set the active main filter
function setActiveFilter(filter) {
    currentFilter = filter;
    
    // Update button appearance
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('bg-blue-500');
        btn.classList.add('bg-gray-500');
    });
    
    const activeButton = document.getElementById(`filter${filter.charAt(0).toUpperCase() + filter.slice(1)}`);
    if (activeButton) {
        activeButton.classList.remove('bg-gray-500');
        activeButton.classList.add('bg-blue-500');
    }
    
    // Update card display
    renderCards();
}

// Function to set the active stars filter
function setActiveStarsFilter(stars) {
    currentStarsFilter = stars;
    
    // Update button appearance
    document.querySelectorAll('.star-filter-btn').forEach(btn => {
        btn.classList.remove('bg-blue-500');
        btn.classList.add('bg-gray-500');
    });
    
    const activeButton = document.getElementById(`filterStars${stars === 'all' ? 'All' : stars}`);
    if (activeButton) {
        activeButton.classList.remove('bg-gray-500');
        activeButton.classList.add('bg-blue-500');
    }
    
    // Update card display
    renderCards();
}

// Add this function to your existing addEventListeners function or call it on load
function addStarFilterListeners() {
    // Add listeners for star filter buttons
    document.getElementById('filterStarsAll').addEventListener('click', function() {
        setActiveStarsFilter('all');
    });
    
    document.getElementById('filterStars1').addEventListener('click', function() {
        setActiveStarsFilter(1);
    });
    
    document.getElementById('filterStars2').addEventListener('click', function() {
        setActiveStarsFilter(2);
    });
    
    document.getElementById('filterStars3').addEventListener('click', function() {
        setActiveStarsFilter(3);
    });
    
    document.getElementById('filterStars4').addEventListener('click', function() {
        setActiveStarsFilter(4);
    });
    
    document.getElementById('filterStars5').addEventListener('click', function() {
        setActiveStarsFilter(5);
    });
    
    // Add listener for Gold filter
    document.getElementById('filterGold').addEventListener('click', function() {
        setActiveFilter('gold');
    });
}

    // Function to toggle a section
    function toggleSection(sectionId) {
        const section = document.getElementById(sectionId);
        const toggle = document.getElementById(sectionId + 'Toggle');
        
        if (section.style.display === 'none') {
            // Expand section
            section.style.display = 'block';
            toggle.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>';
        } else {
            // Collapse section
            section.style.display = 'none';
            toggle.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 15 12 9 18 15"></polyline></svg>';
        }
        
        // Save state in local storage
        localStorage.setItem(sectionId + 'State', section.style.display === 'none' ? 'collapsed' : 'expanded');
    }
    
    // Function to restore section states on page load
    function restoreSectionStates() {
        const sections = ['accountsSection', 'statisticsSection'];
        
        sections.forEach(sectionId => {
            const savedState = localStorage.getItem(sectionId + 'State');
            if (savedState === 'collapsed') {
                // Simulate a click to collapse the section
                toggleSection(sectionId);
                restoreSectionStates();
            }
        });
    }

    // Initialize when the page loads
    document.addEventListener('DOMContentLoaded', init);
        addStarFilterListeners();
</script>

<!-- Cards data script (to include or reference) -->
<script src="js/cardsData.js"></script>

<!-- PayPal floating button with English text -->
<div id="paypal-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 999; display: flex; flex-direction: column; align-items: center;">
    <div id="paypal-text" style="background-color: #0070ba; color: white; padding: 5px 10px; border-radius: 4px; margin-bottom: 8px; font-size: 14px; opacity: 0; transform: translateY(10px); transition: all 0.3s ease; pointer-events: none; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
        Support
    </div>
    <a href="https://www.paypal.me/delvillethibaut/" target="_blank" rel="noopener noreferrer" title="Donate to support development" 
       style="display: flex; align-items: center; justify-content: center; background-color: #0070ba; color: white; width: 48px; height: 48px; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.2); text-decoration: none; font-size: 20px; font-weight: bold; opacity: 0.7; transition: all 0.3s ease; cursor: pointer;" 
       id="paypal-button" onmouseenter="showPayPalText()" onmouseleave="hidePayPalText()" onmousedown="pressPayPalButton()" onmouseup="releasePayPalButton()">
        <svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7.02 5.5H14.38C15.87 5.5 17.18 6.31 17.72 7.61C18.1 8.59 18.03 9.74 17.5 10.67C16.96 11.59 16.04 12.22 14.98 12.4C15.27 12.52 15.54 12.67 15.77 12.87C16.17 13.22 16.46 13.68 16.59 14.25C16.74 14.84 16.7 15.5 16.47 16.11C16.2 16.86 15.66 17.46 14.96 17.85C14.23 18.25 13.35 18.41 12.47 18.32C11.55 18.29 10.73 17.98 10.06 17.48C9.36 16.96 8.86 16.21 8.65 15.36C8.44 14.49 8.53 13.51 8.96 12.71H7.5C5.8 12.71 4.5 11.43 4.5 9.75C4.5 7.5 5.55 5.5 7.02 5.5Z" stroke="white" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M19.5 9.5V16.75C19.5 18.13 18.38 19.25 17 19.25H9" stroke="white" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
    </a>
</div>

<!-- Script for PayPal button interactions -->
<script>
function showPayPalText() {
    document.getElementById('paypal-button').style.opacity = '1';
    document.getElementById('paypal-button').style.transform = 'scale(1.1)';
    document.getElementById('paypal-text').style.opacity = '1';
    document.getElementById('paypal-text').style.transform = 'translateY(0)';
}

function hidePayPalText() {
    document.getElementById('paypal-button').style.opacity = '0.7';
    document.getElementById('paypal-button').style.transform = 'scale(1)';
    document.getElementById('paypal-text').style.opacity = '0';
    document.getElementById('paypal-text').style.transform = 'translateY(10px)';
}

function pressPayPalButton() {
    document.getElementById('paypal-button').style.transform = 'scale(0.95)';
}

function releasePayPalButton() {
    document.getElementById('paypal-button').style.transform = 'scale(1.1)';
}

// Handle opacity during scrolling
window.addEventListener('scroll', function() {
    // Reduce opacity during scrolling to be even more discreet
    document.getElementById('paypal-container').style.opacity = '0.5';
    
    // Restore opacity after scrolling
    clearTimeout(window.scrollTimeout);
    window.scrollTimeout = setTimeout(function() {
        document.getElementById('paypal-container').style.opacity = '1';
    }, 800);
});
</script>

</body>
</html>